<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TikTok Gift Climber</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    #giftBtn {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 12px 20px;
      font-size: 18px;
      background: #ff0066;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      z-index: 10;
    }
  </style>
</head>
<body>
<button id="giftBtn">Simulate Gift (+1 climber)</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152/examples/js/loaders/GLTFLoader.js"></script>

<script>
// -----------------------------------------------------
// BASIC SCENE SETUP
// -----------------------------------------------------
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x222222, 10, 80);

const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 200);
camera.position.set(0, 3, 10);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(renderer.domElement);

// Lighting
const light = new THREE.DirectionalLight(0xffffff, 1.2);
light.position.set(5, 10, 7);
scene.add(light);

scene.add(new THREE.AmbientLight(0xffffff, 0.4));

// -----------------------------------------------------
// MOUNTAIN GEOMETRY
// -----------------------------------------------------
const mountainGeometry = new THREE.ConeGeometry(10, 30, 16);
const mountainMaterial = new THREE.MeshStandardMaterial({ color: 0x666666 });
const mountain = new THREE.Mesh(mountainGeometry, mountainMaterial);
mountain.position.y = -5;
scene.add(mountain);

// -----------------------------------------------------
// CLIMBER MODEL LOADING
// -----------------------------------------------------
const loader = new THREE.GLTFLoader();
let climberModel = null;
let climbers = [];
let mixers = [];
const pathRadius = 6;

// Free model used from CDN (simple animated character)
loader.load(
  "https://models.babylonjs.com/CesiumMan/glTF/CesiumMan.gltf",
  (gltf) => {
    climberModel = gltf.scene;
    climberModel.scale.set(0.02, 0.02, 0.02);

    const mixer = new THREE.AnimationMixer(climberModel);
    mixer.clipAction(gltf.animations[0]).play();

    addClimber(); // Add first climber
  }
);

// -----------------------------------------------------
// ADD NEW CLIMBER ON GIFT
// -----------------------------------------------------
function addClimber() {
  if (!climberModel) return;

  const newClimber = climberModel.clone();
  newClimber.userData.angle = Math.random() * Math.PI * 2; // random starting point
  newClimber.userData.speed = 0.005 + Math.random() * 0.004;

  const mixer = new THREE.AnimationMixer(newClimber);
  mixers.push(mixer);

  climbers.push(newClimber);
  scene.add(newClimber);
}

document.getElementById("giftBtn").onclick = addClimber;

// Keyboard gift simulation
window.addEventListener("keydown", (e) => {
  if (e.key === "g" || e.key === "G") addClimber();
});

// -----------------------------------------------------
// ANIMATION LOOP
// -----------------------------------------------------
const clock = new THREE.Clock();

function animate() {
  requestAnimationFrame(animate);

  const delta = clock.getDelta();
  mixers.forEach((m) => m.update(delta));

  climbers.forEach((c) => {
    c.userData.angle += c.userData.speed;

    c.position.set(
      Math.cos(c.userData.angle) * pathRadius,
      c.userData.angle * 0.5, // climb upward
      Math.sin(c.userData.angle) * pathRadius
    );

    c.lookAt(0, c.position.y + 1, 0);
  });

  renderer.render(scene, camera);
}

animate();

// Resize
window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
